<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./images/favicon-32x32.png">
  <link rel="stylesheet" href="./style.css">
  <title>Frontend Mentor | Calculator app</title>

</head>
<body data-theme="dark">
  <div class="container">
      <div class="theme-container">1 2 3</div>
      <div class="header">
        <span id="calc-text">calc</span> 
        <div class="stick-to-end">THEME</div>
        <div class="btn-holder">
          <div class="btn-circle"></div>
        </div>
      </div>
      <div class="calculation-container"> <div class="screen"></div></div>
      <div class="grid">

        <button class="button-style-1">7</button>
        <button class="button-style-1">8</button>
        <button class="button-style-1">9</button>
        <button class="blue-button">DEL</button>
        <button class="button-style-1">4</button>
        <button class="button-style-1">5</button>
        <button class="button-style-1">6</button>
        <button class="plus-button">+</button>
        <button class="button-style-1">1</button>
        <button class="button-style-1">2</button>
        <button class="button-style-1">3</button>
        <button class="button-style-1 minus-button">-</button>
        <button class="button-style-1 decimal-button">.</button>
        <button class="button-style-1">0</button>
        <button class="button-style-1 divide-button">/</button>
        <button class="button-style-1 multiply-button">x</button>
        <button class="blue-button last-group-button ">RESET</button>
        <button class="button-style-1 last-group-button orange-button">=</button>


      </div>
  </div>

  <script>

    // theme toggle button

    const toggleButton = document.querySelector('.btn-circle');
    const body = document.body;
    const themes = ['light', 'third-theme', 'dark'];
    let state = 0;

    function toggleTheme() {
      state = (state + 1) % themes.length;
      const theme = themes[state];
      body.setAttribute('data-theme', theme);
      toggleButton.classList.toggle('active', state === 0);
      toggleButton.classList.toggle('active-2', state === 1);
    }

    toggleButton.addEventListener('click', toggleTheme);

    // refactored by gpt 



    const calBtns = document.querySelectorAll('.grid');
    const screen = document.querySelector('.screen');
    const validKeysRegex = /^[\dx+\-*\/.=]|Enter$|^Backspace$/;
    let stack = [];

    function checkValidKey(char) {
      return validKeysRegex.test(char);
    }


    // listens for a keypress
    body.addEventListener('keydown', function(e) {
      console.log(e.key)
      const isValidKey = checkValidKey(e.key)
      console.log(isValidKey);
      
      if (isValidKey) {
        let key = e.key
          switch(key) {
            case "x":
              key = "*"
              break;
            case "Backspace":
              key = false
              stack.pop()
              screen.innerText = stack.join('')
              break;
            case "=":
              key = false
              screen.innerText = eval(stack.join(''))
              stack = []
              break;
            case "Enter":
              key = false
              console.log("yee?")
              screen.innerText = eval(stack.join(''))
              stack = []
              break;
          }
          key ? stack.push(key) : {}
          key ? screen.innerText = stack.join('') : {}

          console.log(stack)
      }

    })


    // listens to which button is clicked on the calculator
    calBtns.forEach(function(element) {
      element.addEventListener('click', function(e) {
        const value = e.target.innerText

        switch(value) {
          case "=":
            try {
              screen.innerText = eval(stack.join(''))
            } catch (error) {
              screen.innerText = "ERROR"
            }
            stack = []
            break;
          case "RESET":
            stack = []
            screen.innerText = ""
            break;
          case "DEL":
            stack.pop()
            screen.innerText = stack.join('')
            break;
          case "x":
            stack.push("*")
            screen.innerText = stack.join('')
            break;
          default:
            stack.push(value)
            screen.innerText = stack.join('')
            break;

        }

        console.log(stack)

      })
    })






  </script>
</body>
<footer class="attribution">
  Challenge by <a href="https://www.frontendmentor.io?ref=challenge" target="_blank">Frontend Mentor</a>.
  Coded by <a href="#">defunSM</a>.
</footer>
</html>
